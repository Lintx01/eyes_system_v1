{% extends 'base.html' %}

{% block title %}模拟考试结果{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>模拟考试结果</h2>
                <a href="{% url 'student_mock_exam_list' %}" class="btn btn-primary">
                    <i class="fas fa-list"></i> 返回考试列表
                </a>
            </div>
            
            <!-- 成绩概览 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">成绩概览</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-2">
                            <h3 class="
                                {% if exam_result.score >= 85 %}text-success
                                {% elif exam_result.score >= 70 %}text-warning
                                {% else %}text-danger
                                {% endif %}">
                                {{ exam_result.score|floatformat:1 }}
                            </h3>
                            <p class="mb-0">总分</p>
                        </div>
                        <div class="col-md-2">
                            <h3 class="text-info">{{ exam_result.accuracy }}%</h3>
                            <p class="mb-0">正确率</p>
                        </div>
                        <div class="col-md-2">
                            <h3 class="text-primary">{{ exam_result.correct_answers }}</h3>
                            <p class="mb-0">答对题数</p>
                        </div>
                        <div class="col-md-2">
                            <h3 class="text-secondary">{{ exam_result.total_questions }}</h3>
                            <p class="mb-0">总题数</p>
                        </div>
                        <div class="col-md-2">
                            <h3 class="text-dark">{{ exam_result.time_spent }}</h3>
                            <p class="mb-0">用时(分钟)</p>
                        </div>
                        <div class="col-md-2">
                            <h3 class="text-muted">{{ exam_result.created_at|date:"H:i" }}</h3>
                            <p class="mb-0">完成时间</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 答题详情 -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">答题详情</h5>
                    <div>
                        <span class="badge badge-success">{{ correct_count }} 正确</span>
                        <span class="badge badge-danger ml-1">{{ wrong_count }} 错误</span>
                        {% if unanswered_count > 0 %}
                        <span class="badge badge-secondary ml-1">{{ unanswered_count }} 未答</span>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    {% for detail in answer_details %}
                    <div class="question-detail mb-4 p-3 border rounded">
                        <div class="row">
                            <div class="col-md-8">
                                <h6 class="text-primary">
                                    题目 {{ detail.question_number }}
                                    {% if detail.is_correct %}
                                        <span class="badge badge-success ml-2">
                                            <i class="fas fa-check"></i> 正确
                                        </span>
                                    {% elif detail.user_answer %}
                                        <span class="badge badge-danger ml-2">
                                            <i class="fas fa-times"></i> 错误
                                        </span>
                                    {% else %}
                                        <span class="badge badge-secondary ml-2">
                                            <i class="fas fa-minus"></i> 未答
                                        </span>
                                    {% endif %}
                                </h6>
                                
                                <p class="question-text mb-3">{{ detail.exercise.question_text }}</p>
                                
                                <!-- 显示案例图片 -->
                                {% if detail.exercise.case.image %}
                                <div class="case-image mb-3">
                                    <img src="{{ detail.exercise.case.image.url }}" 
                                         class="img-thumbnail" 
                                         alt="{{ detail.exercise.case.title }}"
                                         style="max-height: 150px;">
                                </div>
                                {% endif %}
                                
                                <!-- 答案区域 -->
                                <div class="answer-section">
                                    {% if detail.user_answer %}
                                        <p class="mb-1">
                                            <strong>您的答案：</strong>
                                            <span class="{% if detail.is_correct %}text-success{% else %}text-danger{% endif %}">
                                                {{ detail.user_answer }}
                                            </span>
                                        </p>
                                    {% else %}
                                        <p class="mb-1">
                                            <strong>您的答案：</strong>
                                            <span class="text-muted">未作答</span>
                                        </p>
                                    {% endif %}
                                    
                                    {% if not detail.is_correct %}
                                        <p class="mb-1">
                                            <strong>正确答案：</strong>
                                            <span class="text-success">{{ detail.correct_answer }}</span>
                                        </p>
                                    {% endif %}
                                </div>
                                
                                <!-- 解析 -->
                                {% if detail.exercise.explanation %}
                                <div class="explanation mt-3">
                                    <h6 class="text-info">
                                        <i class="fas fa-lightbulb"></i> 解析：
                                    </h6>
                                    <p class="text-muted">{{ detail.exercise.explanation }}</p>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4">
                                <div class="question-meta">
                                    <h6 class="text-secondary">题目信息</h6>
                                    <p class="mb-1">
                                        <small class="text-muted">
                                            <i class="fas fa-tag"></i> 
                                            案例：{{ detail.exercise.case.title }}
                                        </small>
                                    </p>
                                    {% if detail.exercise.difficulty %}
                                    <p class="mb-1">
                                        <small class="text-muted">
                                            <i class="fas fa-star"></i> 
                                            难度：{{ detail.exercise.get_difficulty_display }}
                                        </small>
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- 操作按钮 -->
            <div class="text-center mt-4 mb-5">
                <a href="{% url 'start_mock_exam' %}" class="btn btn-primary btn-lg mr-3">
                    <i class="fas fa-redo"></i> 再次考试
                </a>
                <a href="{% url 'student_mock_exam_list' %}" class="btn btn-secondary btn-lg">
                    <i class="fas fa-list"></i> 查看历史记录
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.card-header {
    background-color: #007bff;
    color: white;
}
.card-header h5, .card-header h6 {
    color: white;
}
.question-detail {
    background-color: #f8f9fa;
}
.question-detail.correct {
    border-left: 4px solid #28a745 !important;
}
.question-detail.incorrect {
    border-left: 4px solid #dc3545 !important;
}
.question-detail.unanswered {
    border-left: 4px solid #6c757d !important;
}
.case-image img {
    max-width: 100%;
    height: auto;
}
.explanation {
    background-color: #e3f2fd;
    padding: 10px;
    border-radius: 5px;
    border-left: 4px solid #2196f3;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 为答题详情添加相应的CSS类
    const questionDetails = document.querySelectorAll('.question-detail');
    questionDetails.forEach((detail, index) => {
        const badge = detail.querySelector('.badge');
        if (badge.classList.contains('badge-success')) {
            detail.classList.add('correct');
        } else if (badge.classList.contains('badge-danger')) {
            detail.classList.add('incorrect');
        } else {
            detail.classList.add('unanswered');
        }
    });
});
</script>
{% endblock %}